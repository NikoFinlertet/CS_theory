# –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö üèóÔ∏è

## üè† –ù–∞–≤–∏–≥–∞—Ü–∏—è
**[[README|üè† –ë–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö]]** ‚Üí **–ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î**

**–°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã:**
- üêò [[postgresql|PostgreSQL]]
- üçÉ [[mongodb|MongoDB]]
- üî¥ [[redis|Redis]]
- üè≠ [[data-warehousing|Data Warehousing]]
- üèóÔ∏è [[database-architecture-patterns|–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã]]

---

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

–ü—Ä–∞–≤–∏–ª—å–Ω–æ–µ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö ‚Äî —ç—Ç–æ –æ—Å–Ω–æ–≤–∞ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ–π –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π —Å–∏—Å—Ç–µ–º—ã. –û—Ç –∫–∞—á–µ—Å—Ç–≤–∞ –º–æ–¥–µ–ª–∏ –¥–∞–Ω–Ω—ã—Ö –∑–∞–≤–∏—Å–∏—Ç –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∏ —É–¥–æ–±—Å—Ç–≤–æ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏—è –≤—Å–µ–≥–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è.

### ‚ú® –ö–ª—é—á–µ–≤—ã–µ —Ü–µ–ª–∏ –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **üéØ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç—å** - –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ —Ç–æ—á–Ω–æ –æ—Ç—Ä–∞–∂–∞—Ç—å –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å
2. **‚ö° –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –∏ –æ–ø–µ—Ä–∞—Ü–∏–∏
3. **üîí –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å** - –¥–∞–Ω–Ω—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω—ã–º–∏
4. **üìà –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å** - –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ —Ä–æ—Å—Ç—É –æ–±—ä–µ–º–æ–≤
5. **üõ†Ô∏è –°–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ–º–æ—Å—Ç—å** - –ª–µ–≥–∫–æ—Å—Ç—å –≤–Ω–µ—Å–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π

---

## üìê –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö

### üîç –ü–µ—Ä–≤–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (1NF)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –ö–∞–∂–¥–∞—è —è—á–µ–π–∫–∞ —Ç–∞–±–ª–∏—Ü—ã –¥–æ–ª–∂–Ω–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∞—Ç–æ–º–∞—Ä–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ.

#### ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ 1NF
```sql
-- –ü–ª–æ—Ö–æ: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –≤ –æ–¥–Ω–æ–π —è—á–µ–π–∫–µ
CREATE TABLE users_bad (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    phones TEXT  -- "123-456-789, 987-654-321, 555-000-111"
);
```

#### ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 1NF  
```sql
-- –•–æ—Ä–æ—à–æ: –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –¥–ª—è —Ç–µ–ª–µ—Ñ–æ–Ω–æ–≤
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100)
);

CREATE TABLE user_phones (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    phone VARCHAR(20),
    phone_type VARCHAR(10) -- mobile, home, work
);
```

### üîç –í—Ç–æ—Ä–∞—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (2NF)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –¢–∞–±–ª–∏—Ü–∞ –≤ 1NF + –≤—Å–µ –Ω–µ–∫–ª—é—á–µ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–∏—Å—è—Ç –æ—Ç –ø–µ—Ä–≤–∏—á–Ω–æ–≥–æ –∫–ª—é—á–∞.

#### ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ 2NF
```sql
-- –ü–ª–æ—Ö–æ: —á–∞—Å—Ç–∏—á–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç —Å–æ—Å—Ç–∞–≤–Ω–æ–≥–æ –∫–ª—é—á–∞
CREATE TABLE order_items_bad (
    order_id INTEGER,
    product_id INTEGER,
    quantity INTEGER,
    product_name VARCHAR(100),  -- –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç product_id
    product_price DECIMAL(10,2), -- –∑–∞–≤–∏—Å–∏—Ç —Ç–æ–ª—å–∫–æ –æ—Ç product_id
    PRIMARY KEY (order_id, product_id)
);
```

#### ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 2NF
```sql
-- –•–æ—Ä–æ—à–æ: —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –Ω–∞ –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    price DECIMAL(10,2)
);

CREATE TABLE order_items (
    order_id INTEGER,
    product_id INTEGER REFERENCES products(id),
    quantity INTEGER,
    PRIMARY KEY (order_id, product_id)
);
```

### üîç –¢—Ä–µ—Ç—å—è –Ω–æ—Ä–º–∞–ª—å–Ω–∞—è —Ñ–æ—Ä–º–∞ (3NF)

**–ü—Ä–∏–Ω—Ü–∏–ø:** –¢–∞–±–ª–∏—Ü–∞ –≤ 2NF + –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω—ã—Ö –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π.

#### ‚ùå –ù–∞—Ä—É—à–µ–Ω–∏–µ 3NF
```sql
-- –ü–ª–æ—Ö–æ: —Ç—Ä–∞–Ω–∑–∏—Ç–∏–≤–Ω–∞—è –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å
CREATE TABLE employees_bad (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    department_id INTEGER,
    department_name VARCHAR(100), -- –∑–∞–≤–∏—Å–∏—Ç –æ—Ç department_id
    department_location VARCHAR(100) -- –∑–∞–≤–∏—Å–∏—Ç –æ—Ç department_id
);
```

#### ‚úÖ –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ 3NF
```sql
-- –•–æ—Ä–æ—à–æ: –≤—ã–Ω–æ—Å –∑–∞–≤–∏—Å–∏–º—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤
CREATE TABLE departments (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    location VARCHAR(100)
);

CREATE TABLE employees (
    id SERIAL PRIMARY KEY,
    name VARCHAR(100),
    department_id INTEGER REFERENCES departments(id)
);
```

---

## üèóÔ∏è –ü—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å—Ö–µ–º—ã

### üìä ER-–¥–∏–∞–≥—Ä–∞–º–º—ã –∏ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# services/design/er_modeling.py
from dataclasses import dataclass
from typing import List, Dict, Optional
from enum import Enum

class RelationshipType(Enum):
    ONE_TO_ONE = "1:1"
    ONE_TO_MANY = "1:N"
    MANY_TO_MANY = "N:M"

@dataclass
class Entity:
    """–°—É—â–Ω–æ—Å—Ç—å –≤ ER-–º–æ–¥–µ–ª–∏"""
    name: str
    attributes: List[str]
    primary_key: str
    
class Relationship:
    """–°–≤—è–∑—å –º–µ–∂–¥—É —Å—É—â–Ω–æ—Å—Ç—è–º–∏"""
    def __init__(self, entity1: str, entity2: str, 
                 relationship_type: RelationshipType,
                 description: str = ""):
        self.entity1 = entity1
        self.entity2 = entity2
        self.type = relationship_type
        self.description = description

class ERModel:
    """ER-–º–æ–¥–µ–ª—å –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö"""
    
    def __init__(self, name: str):
        self.name = name
        self.entities: Dict[str, Entity] = {}
        self.relationships: List[Relationship] = []
    
    def add_entity(self, entity: Entity):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–∏"""
        self.entities[entity.name] = entity
    
    def add_relationship(self, relationship: Relationship):
        """–î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–≤—è–∑–∏"""
        self.relationships.append(relationship)
    
    def generate_sql_schema(self) -> str:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è SQL —Å—Ö–µ–º—ã"""
        sql_statements = []
        
        # –°–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü –¥–ª—è —Å—É—â–Ω–æ—Å—Ç–µ–π
        for entity in self.entities.values():
            columns = []
            for attr in entity.attributes:
                if attr == entity.primary_key:
                    columns.append(f"{attr} SERIAL PRIMARY KEY")
                else:
                    columns.append(f"{attr} VARCHAR(255)")
            
            sql = f"""
CREATE TABLE {entity.name} (
    {',\n    '.join(columns)}
);"""
            sql_statements.append(sql.strip())
        
        # –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–Ω–µ—à–Ω–∏—Ö –∫–ª—é—á–µ–π –¥–ª—è —Å–≤—è–∑–µ–π
        for rel in self.relationships:
            if rel.type == RelationshipType.ONE_TO_MANY:
                # –î–æ–±–∞–≤–ª—è–µ–º FK –≤ "–º–Ω–æ–≥–∏–µ"
                fk_sql = f"""
ALTER TABLE {rel.entity2} 
ADD COLUMN {rel.entity1}_id INTEGER REFERENCES {rel.entity1}(id);"""
                sql_statements.append(fk_sql.strip())
            
            elif rel.type == RelationshipType.MANY_TO_MANY:
                # –°–æ–∑–¥–∞–µ–º –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—É—é —Ç–∞–±–ª–∏—Ü—É
                junction_table = f"{rel.entity1}_{rel.entity2}"
                junction_sql = f"""
CREATE TABLE {junction_table} (
    {rel.entity1}_id INTEGER REFERENCES {rel.entity1}(id),
    {rel.entity2}_id INTEGER REFERENCES {rel.entity2}(id),
    PRIMARY KEY ({rel.entity1}_id, {rel.entity2}_id)
);"""
                sql_statements.append(junction_sql.strip())
        
        return '\n\n'.join(sql_statements)

# –ü—Ä–∏–º–µ—Ä: –º–æ–¥–µ–ª—å –∏–Ω—Ç–µ—Ä–Ω–µ—Ç-–º–∞–≥–∞–∑–∏–Ω–∞
ecommerce_model = ERModel("E-Commerce System")

# –°—É—â–Ω–æ—Å—Ç–∏
ecommerce_model.add_entity(Entity(
    name="users",
    attributes=["id", "email", "password_hash", "name", "created_at"],
    primary_key="id"
))

ecommerce_model.add_entity(Entity(
    name="categories",
    attributes=["id", "name", "description", "parent_id"],
    primary_key="id"
))

ecommerce_model.add_entity(Entity(
    name="products",
    attributes=["id", "name", "description", "price", "stock_quantity"],
    primary_key="id"
))

ecommerce_model.add_entity(Entity(
    name="orders",
    attributes=["id", "total_amount", "status", "created_at"],
    primary_key="id"
))

ecommerce_model.add_entity(Entity(
    name="order_items",
    attributes=["id", "quantity", "price_at_time"],
    primary_key="id"
))

# –°–≤—è–∑–∏
ecommerce_model.add_relationship(Relationship(
    "categories", "products", 
    RelationshipType.ONE_TO_MANY,
    "–ö–∞—Ç–µ–≥–æ—Ä–∏—è —Å–æ–¥–µ—Ä–∂–∏—Ç –ø—Ä–æ–¥—É–∫—Ç—ã"
))

ecommerce_model.add_relationship(Relationship(
    "users", "orders",
    RelationshipType.ONE_TO_MANY,
    "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –¥–µ–ª–∞–µ—Ç –∑–∞–∫–∞–∑—ã"
))

ecommerce_model.add_relationship(Relationship(
    "orders", "order_items",
    RelationshipType.ONE_TO_MANY,
    "–ó–∞–∫–∞–∑ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–æ–∑–∏—Ü–∏–∏"
))

ecommerce_model.add_relationship(Relationship(
    "products", "order_items",
    RelationshipType.ONE_TO_MANY,
    "–ü—Ä–æ–¥—É–∫—Ç –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Ä–∞–∑–Ω—ã—Ö –∑–∞–∫–∞–∑–∞—Ö"
))

print(ecommerce_model.generate_sql_schema())
```

---

## üé® –ü–∞—Ç—Ç–µ—Ä–Ω—ã –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

### üîë –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –∫–ª—é—á–∏

```sql
-- –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è)
CREATE TABLE users (
    id SERIAL PRIMARY KEY,  -- –°—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–π –∫–ª—é—á
    email VARCHAR(255) UNIQUE NOT NULL,  -- –ï—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω—ã–π –∫–ª—é—á –∫–∞–∫ constraint
    name VARCHAR(100),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã—Ö –∫–ª—é—á–µ–π:
-- 1. –ù–µ–∏–∑–º–µ–Ω–Ω–æ—Å—Ç—å
-- 2. –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å (integer vs string)
-- 3. –ü—Ä–æ—Å—Ç–æ—Ç–∞ —Å–≤—è–∑–µ–π
-- 4. –ù–µ–∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –æ—Ç –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∏
```

### üè∑Ô∏è Lookup Tables (–°–ø—Ä–∞–≤–æ—á–Ω–∏–∫–∏)

```sql
-- –ü–∞—Ç—Ç–µ—Ä–Ω —Å–ø—Ä–∞–≤–æ—á–Ω—ã—Ö —Ç–∞–±–ª–∏—Ü
CREATE TABLE order_statuses (
    id SERIAL PRIMARY KEY,
    code VARCHAR(20) UNIQUE NOT NULL,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    is_active BOOLEAN DEFAULT TRUE
);

INSERT INTO order_statuses (code, name) VALUES 
('pending', '–û–∂–∏–¥–∞–µ—Ç –æ–±—Ä–∞–±–æ—Ç–∫–∏'),
('processing', '–í –æ–±—Ä–∞–±–æ—Ç–∫–µ'),
('shipped', '–û—Ç–ø—Ä–∞–≤–ª–µ–Ω'),
('delivered', '–î–æ—Å—Ç–∞–≤–ª–µ–Ω'),
('cancelled', '–û—Ç–º–µ–Ω–µ–Ω');

CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    status_id INTEGER REFERENCES order_statuses(id),
    total_amount DECIMAL(10,2),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

### üìã Audit Trail (–ê—É–¥–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏–π)

```sql
-- –ü–∞—Ç—Ç–µ—Ä–Ω –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    created_by INTEGER REFERENCES users(id),
    updated_by INTEGER REFERENCES users(id)
);

-- –¢–∞–±–ª–∏—Ü–∞ –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
CREATE TABLE product_audit (
    id SERIAL PRIMARY KEY,
    product_id INTEGER REFERENCES products(id),
    field_name VARCHAR(100),
    old_value TEXT,
    new_value TEXT,
    changed_by INTEGER REFERENCES users(id),
    changed_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    operation VARCHAR(10) -- INSERT, UPDATE, DELETE
);

-- –¢—Ä–∏–≥–≥–µ—Ä –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –∞—É–¥–∏—Ç–∞
CREATE OR REPLACE FUNCTION audit_product_changes()
RETURNS TRIGGER AS $$
BEGIN
    IF TG_OP = 'UPDATE' THEN
        -- –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–∞–∂–¥–æ–µ –ø–æ–ª–µ –Ω–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è
        IF OLD.name != NEW.name THEN
            INSERT INTO product_audit (product_id, field_name, old_value, new_value, changed_by, operation)
            VALUES (NEW.id, 'name', OLD.name, NEW.name, NEW.updated_by, 'UPDATE');
        END IF;
        
        IF OLD.price != NEW.price THEN
            INSERT INTO product_audit (product_id, field_name, old_value, new_value, changed_by, operation)
            VALUES (NEW.id, 'price', OLD.price::TEXT, NEW.price::TEXT, NEW.updated_by, 'UPDATE');
        END IF;
        
        NEW.updated_at = CURRENT_TIMESTAMP;
        RETURN NEW;
    END IF;
    
    RETURN NULL;
END;
$$ LANGUAGE plpgsql;

CREATE TRIGGER product_audit_trigger
    AFTER UPDATE ON products
    FOR EACH ROW
    EXECUTE FUNCTION audit_product_changes();
```

### üîÑ Soft Delete (–ú—è–≥–∫–æ–µ —É–¥–∞–ª–µ–Ω–∏–µ)

```sql
-- –ü–∞—Ç—Ç–µ—Ä–Ω –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10,2) NOT NULL,
    is_deleted BOOLEAN DEFAULT FALSE,
    deleted_at TIMESTAMP NULL,
    deleted_by INTEGER REFERENCES users(id),
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ò–Ω–¥–µ–∫—Å –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–ø–∏—Å–µ–π
CREATE INDEX idx_products_active ON products (id) WHERE is_deleted = FALSE;

-- –ü—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–ª—å–∫–æ –∞–∫—Ç–∏–≤–Ω—ã—Ö –ø—Ä–æ–¥—É–∫—Ç–æ–≤
CREATE VIEW active_products AS
SELECT id, name, price, created_at
FROM products 
WHERE is_deleted = FALSE;

-- –§—É–Ω–∫—Ü–∏—è –º—è–≥–∫–æ–≥–æ —É–¥–∞–ª–µ–Ω–∏—è
CREATE OR REPLACE FUNCTION soft_delete_product(product_id INTEGER, deleted_by_user INTEGER)
RETURNS BOOLEAN AS $$
BEGIN
    UPDATE products 
    SET is_deleted = TRUE,
        deleted_at = CURRENT_TIMESTAMP,
        deleted_by = deleted_by_user
    WHERE id = product_id AND is_deleted = FALSE;
    
    RETURN FOUND;
END;
$$ LANGUAGE plpgsql;
```

---

## üîí –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏

### ‚úÖ Check Constraints

```sql
-- –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
CREATE TABLE products (
    id SERIAL PRIMARY KEY,
    name VARCHAR(255) NOT NULL,
    price DECIMAL(10,2) NOT NULL CHECK (price > 0),
    stock_quantity INTEGER CHECK (stock_quantity >= 0),
    rating DECIMAL(3,2) CHECK (rating >= 0 AND rating <= 5),
    category_id INTEGER REFERENCES categories(id),
    
    -- –°–ª–æ–∂–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
    CONSTRAINT valid_price_range CHECK (
        CASE 
            WHEN category_id = 1 THEN price BETWEEN 10 AND 1000  -- –≠–ª–µ–∫—Ç—Ä–æ–Ω–∏–∫–∞
            WHEN category_id = 2 THEN price BETWEEN 5 AND 500    -- –ö–Ω–∏–≥–∏
            ELSE price > 0
        END
    )
);

-- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ —Ç–∞–±–ª–∏—Ü—ã
CREATE TABLE orders (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    discount_amount DECIMAL(10,2) DEFAULT 0,
    total_amount DECIMAL(10,2) NOT NULL,
    
    -- –°–∫–∏–¥–∫–∞ –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –±–æ–ª—å—à–µ —Å—É–º–º—ã –∑–∞–∫–∞–∑–∞
    CONSTRAINT valid_discount CHECK (discount_amount <= total_amount),
    
    -- –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—É–º–º–∞ –∑–∞–∫–∞–∑–∞
    CONSTRAINT min_order_amount CHECK (total_amount >= 1.00)
);
```

### üîó –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

```sql
-- –ü—Ä–æ—Å—Ç—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
CREATE TABLE users (
    id SERIAL PRIMARY KEY,
    email VARCHAR(255) UNIQUE NOT NULL,
    phone VARCHAR(20) UNIQUE,
    username VARCHAR(50) UNIQUE NOT NULL
);

-- –°–æ—Å—Ç–∞–≤–Ω—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è
CREATE TABLE user_addresses (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    address_type VARCHAR(20), -- home, work, billing
    street VARCHAR(255),
    city VARCHAR(100),
    
    -- –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–º–µ—Ç—å —Ç–æ–ª—å–∫–æ –æ–¥–∏–Ω –∞–¥—Ä–µ—Å –∫–∞–∂–¥–æ–≥–æ —Ç–∏–ø–∞
    UNIQUE (user_id, address_type)
);

-- –ß–∞—Å—Ç–∏—á–Ω—ã–µ —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è (—Å —É—Å–ª–æ–≤–∏–µ–º)
CREATE TABLE user_settings (
    id SERIAL PRIMARY KEY,
    user_id INTEGER REFERENCES users(id),
    setting_key VARCHAR(100),
    setting_value TEXT,
    is_active BOOLEAN DEFAULT TRUE,
    
    -- –£–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫
    CONSTRAINT unique_active_setting 
    EXCLUDE USING btree (user_id WITH =, setting_key WITH =) 
    WHERE (is_active = TRUE)
);
```

---

## üìä –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚ö° –ö–æ–≥–¥–∞ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞—Ç—å

```sql
-- –ü—Ä–∏–º–µ—Ä: —á–∞—Å—Ç—ã–µ –∑–∞–ø—Ä–æ—Å—ã —Å–æ —Å–ª–æ–∂–Ω—ã–º–∏ JOIN'–∞–º–∏
-- –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–º–µ–¥–ª–µ–Ω–Ω–æ)
SELECT 
    o.id,
    u.name as user_name,
    u.email,
    COUNT(oi.id) as item_count,
    SUM(oi.quantity * oi.price) as total_amount
FROM orders o
JOIN users u ON o.user_id = u.id
JOIN order_items oi ON o.id = oi.order_id
GROUP BY o.id, u.name, u.email;

-- –î–µ–Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ (–±—ã—Å—Ç—Ä–æ)
CREATE TABLE order_summary (
    order_id INTEGER PRIMARY KEY REFERENCES orders(id),
    user_name VARCHAR(255),
    user_email VARCHAR(255),
    item_count INTEGER,
    total_amount DECIMAL(10,2),
    last_updated TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);

-- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–µ—Ä–µ–∑ —Ç—Ä–∏–≥–≥–µ—Ä—ã
CREATE OR REPLACE FUNCTION update_order_summary()
RETURNS TRIGGER AS $$
BEGIN
    INSERT INTO order_summary (order_id, user_name, user_email, item_count, total_amount)
    SELECT 
        o.id,
        u.name,
        u.email,
        COUNT(oi.id),
        SUM(oi.quantity * oi.price)
    FROM orders o
    JOIN users u ON o.user_id = u.id
    LEFT JOIN order_items oi ON o.id = oi.order_id
    WHERE o.id = NEW.order_id
    GROUP BY o.id, u.name, u.email
    ON CONFLICT (order_id) DO UPDATE SET
        item_count = EXCLUDED.item_count,
        total_amount = EXCLUDED.total_amount,
        last_updated = CURRENT_TIMESTAMP;
    
    RETURN NEW;
END;
$$ LANGUAGE plpgsql;
```

---

## üéØ –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### üî∞ –ù–∞—á–∞–ª—å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
1. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ö–µ–º—É –¥–ª—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ (–∫–Ω–∏–≥–∏, –∞–≤—Ç–æ—Ä—ã, —á–∏—Ç–∞—Ç–µ–ª–∏, –≤—ã–¥–∞—á–∏)
2. –ü—Ä–∏–≤–µ–¥–∏—Ç–µ —Ç–∞–±–ª–∏—Ü—É –∫ 3NF, –∏—Å–ø—Ä–∞–≤–∏–≤ –Ω–∞—Ä—É—à–µ–Ω–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
3. –î–æ–±–∞–≤—å—Ç–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏ –¥–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö

### üöÄ –°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å
1. –°–æ–∑–¥–∞–π—Ç–µ ER-–º–æ–¥–µ–ª—å –¥–ª—è —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π —Å–µ—Ç–∏ —Å –¥—Ä—É–∑—å—è–º–∏, –ø–æ—Å—Ç–∞–º–∏ –∏ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏—è–º–∏
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ —Å–∏—Å—Ç–µ–º—É –∞—É–¥–∏—Ç–∞ –∏–∑–º–µ–Ω–µ–Ω–∏–π –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö —Ç–∞–±–ª–∏—Ü
3. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—É—é –∏–µ—Ä–∞—Ä—Ö–∏—é –∫–∞—Ç–µ–≥–æ—Ä–∏–π —Å —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–º–∏ –∑–∞–ø—Ä–æ—Å–∞–º–∏

### üíé –ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å
1. –°–æ–∑–¥–∞–π—Ç–µ —Å—Ö–µ–º—É –¥–ª—è –º–Ω–æ–≥–æ–∞—Ä–µ–Ω–¥–Ω–æ–π SaaS —Å–∏—Å—Ç–µ–º—ã —Å –∏–∑–æ–ª—è—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö
2. –†–µ–∞–ª–∏–∑—É–π—Ç–µ temporal tables –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏—Å—Ç–æ—Ä–∏–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–π
3. –°–ø—Ä–æ–µ–∫—Ç–∏—Ä—É–π—Ç–µ —Å—Ö–µ–º—É –¥–ª—è —Å–∏—Å—Ç–µ–º—ã —Å –º–∏–ª–ª–∏–∞—Ä–¥–∞–º–∏ –∑–∞–ø–∏—Å–µ–π, —É—á–∏—Ç—ã–≤–∞—è —à–∞—Ä–¥–∏–Ω–≥

---

## üåü –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏

### ‚úÖ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

#### üèóÔ∏è –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã
- **–ü–æ–Ω–∏–º–∞–π—Ç–µ –ø—Ä–µ–¥–º–µ—Ç–Ω—É—é –æ–±–ª–∞—Å—Ç—å** - –º–æ–¥–µ–ª—å –¥–æ–ª–∂–Ω–∞ –æ—Ç—Ä–∞–∂–∞—Ç—å –±–∏–∑–Ω–µ—Å-—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è
- **–ù–∞—á–∏–Ω–∞–π—Ç–µ —Å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** - –ø–æ—Ç–æ–º –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É–π—Ç–µ –ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏
- **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å—É—Ä—Ä–æ–≥–∞—Ç–Ω—ã–µ –∫–ª—é—á–∏** - –¥–ª—è —Å—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç–∏ –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **–î–æ–±–∞–≤–ª—è–π—Ç–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ** - created_at, updated_at, version

#### üîí –¶–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –¥–∞–Ω–Ω—ã—Ö
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ —É—Ä–æ–≤–Ω–µ –ë–î** - –Ω–µ –ø–æ–ª–∞–≥–∞–π—Ç–µ—Å—å —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
- **–í–Ω–µ—à–Ω–∏–µ –∫–ª—é—á–∏** - –¥–ª—è —Å—Å—ã–ª–æ—á–Ω–æ–π —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç–∏
- **Check constraints** - –¥–ª—è –±–∏–∑–Ω–µ—Å-–ø—Ä–∞–≤–∏–ª
- **Null constraints** - —á–µ—Ç–∫–æ –æ–ø—Ä–µ–¥–µ–ª—è–π—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è

#### üìä –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
- **–ò–Ω–¥–µ–∫—Å—ã –Ω–∞ —á–∞—Å—Ç–æ –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ –ø–æ–ª—è** - –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è WHERE, JOIN, ORDER BY
- **–ò–∑–±–µ–≥–∞–π—Ç–µ –∏–∑–±—ã—Ç–æ—á–Ω–æ–π –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏** - –±–∞–ª–∞–Ω—Å –º–µ–∂–¥—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å—é
- **–ü–∞—Ä—Ç–∏—Ü–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–æ–ª—å—à–∏—Ö —Ç–∞–±–ª–∏—Ü** - –¥–ª—è —É–ø—Ä–∞–≤–ª—è–µ–º–æ—Å—Ç–∏
- **–ê—Ä—Ö–∏–≤–∞—Ü–∏—è —Å—Ç–∞—Ä—ã—Ö –¥–∞–Ω–Ω—ã—Ö** - –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

### ‚ùå –ß–µ–≥–æ –∏–∑–±–µ–≥–∞—Ç—å

- **God tables** - –∏–∑–±–µ–≥–∞–π—Ç–µ —Ç–∞–±–ª–∏—Ü —Å –¥–µ—Å—è—Ç–∫–∞–º–∏ –∫–æ–ª–æ–Ω–æ–∫
- **–ò–∑–±—ã—Ç–æ—á–Ω–∞—è –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è** - –Ω–µ –¥–µ–Ω–æ—Ä–º–∞–ª–∏–∑—É–π—Ç–µ –±–µ–∑ –∏–∑–º–µ—Ä–µ–Ω–∏–π
- **–û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏** - —Å—Ö–µ–º–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø–æ–Ω—è—Ç–Ω–∞
- **–ò–≥–Ω–æ—Ä–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏** - —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω—ã—Ö –æ–±—ä–µ–º–∞—Ö

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

- üêò **[[postgresql|PostgreSQL]]** - —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏–Ω—Ü–∏–ø–æ–≤ –≤ PostgreSQL
- üçÉ **[[mongodb|MongoDB]]** - –¥–æ–∫—É–º–µ–Ω—Ç–Ω–æ-–æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏–µ
- üè≠ **[[data-warehousing|Data Warehousing]]** - –ø—Ä–∏–Ω—Ü–∏–ø—ã OLAP –º–æ–¥–µ–ª–∏—Ä–æ–≤–∞–Ω–∏—è
- üèóÔ∏è **[[database-architecture-patterns|–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã]]** - –ø–∞—Ç—Ç–µ—Ä–Ω—ã –Ω–∞ —É—Ä–æ–≤–Ω–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã
- ‚ö° **[[sql-optimization|–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ë–î]]** - –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

**[[README|üè† –í–µ—Ä–Ω—É—Ç—å—Å—è –∫ –æ–±–∑–æ—Ä—É –±–∞–∑ –¥–∞–Ω–Ω—ã—Ö]]** 