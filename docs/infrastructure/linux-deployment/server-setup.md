# üñ•Ô∏è Server Setup: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ Linux —Å–µ—Ä–≤–µ—Ä–æ–≤

## –û–ø–∏—Å–∞–Ω–∏–µ

–ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–∏–∑–≤–æ–¥—Å—Ç–≤–µ–Ω–Ω—ã—Ö Linux —Å–µ—Ä–≤–µ—Ä–æ–≤ –¥–ª—è —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ –≤–∫–ª—é—á–∞–µ—Ç –±–∞–∑–æ–≤—É—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é —Å–∏—Å—Ç–µ–º—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —É—Å—Ç–∞–Ω–æ–≤–∫—É Docker –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.

## –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ Ubuntu/CentOS

### –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–∫—Ä–∏–ø—Ç –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

```bash
#!/bin/bash
# scripts/server-setup.sh
# –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–æ–¥–∞–∫—à–Ω —Å–µ—Ä–≤–µ—Ä–∞ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

# ==================== –û–ë–ù–û–í–õ–ï–ù–ò–ï –°–ò–°–¢–ï–ú–´ ====================
# –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–æ–Ω–Ω–æ–π —Å–∏—Å—Ç–µ–º—ã –∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø–∞–∫–µ—Ç–æ–≤

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ apt (Ubuntu/Debian)
if command -v apt &> /dev/null; then
    echo "üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –±–∞–∑–µ Debian/Ubuntu"
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–∫–µ—Ç–æ–≤ –∏ —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
    sudo apt update && sudo apt upgrade -y
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
    sudo apt install -y \
        curl \                     # HTTP –∫–ª–∏–µ–Ω—Ç –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤
        wget \                     # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
        git \                      # –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π
        vim \                      # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
        htop \                     # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        unzip \                    # –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä
        software-properties-common # –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è–º–∏

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ª–∏—á–∏—è –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –ø–∞–∫–µ—Ç–æ–≤ yum (CentOS/RHEL)
elif command -v yum &> /dev/null; then
    echo "üîÑ –û–±–Ω–∞—Ä—É–∂–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –Ω–∞ –±–∞–∑–µ RedHat/CentOS"
    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Å–µ—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
    sudo yum update -y
    # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑–æ–≤—ã—Ö –ø–∞–∫–µ—Ç–æ–≤ –∏ EPEL —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
    sudo yum install -y \
        curl \        # HTTP –∫–ª–∏–µ–Ω—Ç
        wget \        # –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
        git \         # –°–∏—Å—Ç–µ–º–∞ –∫–æ–Ω—Ç—Ä–æ–ª—è –≤–µ—Ä—Å–∏–π
        vim \         # –¢–µ–∫—Å—Ç–æ–≤—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
        htop \        # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ—Ü–µ—Å—Å–æ–≤
        unzip \       # –ê—Ä—Ö–∏–≤–∞—Ç–æ—Ä
        epel-release  # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –ø–∞–∫–µ—Ç–æ–≤
fi

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê FIREWALL ====================
# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –º–µ–∂—Å–µ—Ç–µ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

echo "üî• –ù–∞—Å—Ç—Ä–æ–π–∫–∞ firewall..."
# –í–∫–ª—é—á–µ–Ω–∏–µ UFW (Uncomplicated Firewall)
sudo ufw enable

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ SSH —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π (–ø–æ—Ä—Ç 22)
sudo ufw allow ssh

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ HTTP —Ç—Ä–∞—Ñ–∏–∫–∞ (–ø–æ—Ä—Ç 80)
sudo ufw allow 80

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ HTTPS —Ç—Ä–∞—Ñ–∏–∫–∞ (–ø–æ—Ä—Ç 443)
sudo ufw allow 443

# –†–∞–∑—Ä–µ—à–µ–Ω–∏–µ –ø–æ—Ä—Ç–æ–≤ –¥–ª—è –Ω–∞—à–∏—Ö –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤ (8080-8082)
sudo ufw allow 8080:8082/tcp  # API Gateway, User Service, Order Service

# ==================== –°–û–ó–î–ê–ù–ò–ï –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–Ø –î–õ–Ø –†–ê–ó–í–ï–†–¢–´–í–ê–ù–ò–Ø ====================
echo "üë§ –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy..."

# –°–æ–∑–¥–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —Å –¥–æ–º–∞—à–Ω–µ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–µ–π –∏ bash shell
sudo useradd -m -s /bin/bash deploy

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É sudo –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã—Ö –ø—Ä–∞–≤
sudo usermod -aG sudo deploy

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è SSH –∫–ª—é—á–µ–π
sudo mkdir -p /home/deploy/.ssh

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å/–≤—ã–ø–æ–ª–Ω—è—Ç—å)
sudo chmod 700 /home/deploy/.ssh

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê SSH –ö–õ–Æ–ß–ï–ô ====================
echo "üîë –ù–∞—Å—Ç—Ä–æ–π–∫–∞ SSH –∫–ª—é—á–µ–π..."

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø—É–±–ª–∏—á–Ω–æ–≥–æ SSH –∫–ª—é—á–∞ –¥–ª—è –±–µ—Å–ø–∞—Ä–æ–ª—å–Ω–æ–π –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
# –í–ê–ñ–ù–û: –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –≤–∞—à —Ä–µ–∞–ª—å–Ω—ã–π –ø—É–±–ª–∏—á–Ω—ã–π –∫–ª—é—á
echo "ssh-rsa AAAAB3NzaC1yc2E... deploy@ci-server" | sudo tee /home/deploy/.ssh/authorized_keys

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã—Ö –ø—Ä–∞–≤ –¥–ª—è —Ñ–∞–π–ª–∞ —Å –∫–ª—é—á–∞–º–∏ (—Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å/–ø–∏—Å–∞—Ç—å)
sudo chmod 600 /home/deploy/.ssh/authorized_keys

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –¥–ª—è –≤—Å–µ–π SSH –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏
sudo chown -R deploy:deploy /home/deploy/.ssh

# ==================== –ü–û–í–´–®–ï–ù–ò–ï –ë–ï–ó–û–ü–ê–°–ù–û–°–¢–ò SSH ====================
echo "üîí –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ SSH..."

# –û—Ç–∫–ª—é—á–µ–Ω–∏–µ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ –ø–æ –ø–∞—Ä–æ–ª—é (–ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–ª—é—á–µ–π)
sudo sed -i 's/#PasswordAuthentication yes/PasswordAuthentication no/' /etc/ssh/sshd_config

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ SSH –¥–µ–º–æ–Ω–∞ –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
sudo systemctl restart sshd

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –õ–û–ì–ò–†–û–í–ê–ù–ò–Ø ====================
echo "üìù –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π..."

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ª–æ–≥–æ–≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
sudo mkdir -p /var/log/applications

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –≤–ª–∞–¥–µ–ª—å—Ü–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –ª–æ–≥–æ–≤
sudo chown deploy:deploy /var/log/applications

# ==================== –ó–ê–í–ï–†–®–ï–ù–ò–ï –ù–ê–°–¢–†–û–ô–ö–ò ====================
echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo "üìã –í—ã–ø–æ–ª–Ω–µ–Ω–æ:"
echo "   - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å–∏—Å—Ç–µ–º–∞"
echo "   - –ù–∞—Å—Ç—Ä–æ–µ–Ω firewall"
echo "   - –°–æ–∑–¥–∞–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å deploy"
echo "   - –ù–∞—Å—Ç—Ä–æ–µ–Ω–∞ SSH –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –ø–æ –∫–ª—é—á–∞–º"
echo "   - –ü–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–∞ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏—è –¥–ª—è –ª–æ–≥–æ–≤"
echo ""
echo "üöÄ –°–µ—Ä–≤–µ—Ä –≥–æ—Ç–æ–≤ –∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—é –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤!"
```

## –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –Ω–∞ Linux

### –°–∫—Ä–∏–ø—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker

```bash
#!/bin/bash
# scripts/install-docker.sh
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∏ Docker Compose –Ω–∞ Linux —Å–µ—Ä–≤–µ—Ä

echo "üê≥ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker..."

# ==================== –£–°–¢–ê–ù–û–í–ö–ê DOCKER ====================
# –ó–∞–≥—Ä—É–∑–∫–∞ –∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–∏–ø—Ç–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ Docker
curl -fsSL https://get.docker.com -o get-docker.sh
sudo sh get-docker.sh

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –ü–û–õ–¨–ó–û–í–ê–¢–ï–õ–ï–ô ====================
# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker $USER

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy –≤ –≥—Ä—É–ø–ø—É docker
sudo usermod -aG docker deploy

# ==================== –£–°–¢–ê–ù–û–í–ö–ê DOCKER COMPOSE ====================
echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker Compose..."

# –ó–∞–≥—Ä—É–∑–∫–∞ Docker Compose v2.23.0
sudo curl -L "https://github.com/docker/compose/releases/download/v2.23.0/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose

# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –ø—Ä–∞–≤ –Ω–∞ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ
sudo chmod +x /usr/local/bin/docker-compose

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –ê–í–¢–û–ó–ê–ü–£–°–ö–ê ====================
echo "‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ Docker..."

# –í–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ–∑–∞–ø—É—Å–∫–∞ Docker –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å–∏—Å—Ç–µ–º—ã
sudo systemctl enable docker

# –ó–∞–ø—É—Å–∫ Docker —Å–ª—É–∂–±—ã
sudo systemctl start docker

# ==================== –ü–†–û–í–ï–†–ö–ê –£–°–¢–ê–ù–û–í–ö–ò ====================
echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏..."

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Docker
docker_version=$(docker --version)
echo "Docker: $docker_version"

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –≤–µ—Ä—Å–∏–∏ Docker Compose
compose_version=$(docker-compose --version)
echo "Docker Compose: $compose_version"

# –¢–µ—Å—Ç –∑–∞–ø—É—Å–∫–∞ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
if docker run --rm hello-world > /dev/null 2>&1; then
    echo "‚úÖ Docker —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ!"
else
    echo "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ Docker"
    exit 1
fi

echo "üéâ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Docker –∑–∞–≤–µ—Ä—à–µ–Ω–∞ —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –î–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π –≥—Ä—É–ø–ø—ã docker –≤—ã–ø–æ–ª–Ω–∏—Ç–µ:"
echo "   newgrp docker"
echo "   –∏–ª–∏ –ø–µ—Ä–µ–ª–æ–≥–∏–Ω—å—Ç–µ—Å—å –≤ —Å–∏—Å—Ç–µ–º—É"
```

## –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –≤—ã—Å–æ–∫–∏—Ö –Ω–∞–≥—Ä—É–∑–æ–∫

```bash
#!/bin/bash
# scripts/optimize-limits.sh
# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π

echo "‚ö° –ù–∞—Å—Ç—Ä–æ–π–∫–∞ —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤..."

# ==================== –£–í–ï–õ–ò–ß–ï–ù–ò–ï –õ–ò–ú–ò–¢–û–í –ù–ê –§–ê–ô–õ–´ ====================
echo "üìÅ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ª–∏–º–∏—Ç–æ–≤ –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã..."

# –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –ª–∏–º–∏—Ç–æ–≤ –≤ /etc/security/limits.conf
sudo tee -a /etc/security/limits.conf << 'EOF'

# –õ–∏–º–∏—Ç—ã –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –æ—Ç–∫—Ä—ã—Ç—ã—Ö —Ñ–∞–π–ª–æ–≤ –¥–ª—è –≤—Å–µ—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π
*               soft    nofile          65536
*               hard    nofile          65536

# –õ–∏–º–∏—Ç—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è deploy
deploy          soft    nofile          65536
deploy          hard    nofile          65536
deploy          soft    nproc           32768
deploy          hard    nproc           32768
EOF

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê SYSTEMD –õ–ò–ú–ò–¢–û–í ====================
echo "üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞ systemd –ª–∏–º–∏—Ç–æ–≤..."

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è systemd –ª–∏–º–∏—Ç–æ–≤
sudo mkdir -p /etc/systemd/system.conf.d/

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –≥–ª–æ–±–∞–ª—å–Ω—ã—Ö –ª–∏–º–∏—Ç–æ–≤ systemd
sudo tee /etc/systemd/system.conf.d/limits.conf << 'EOF'
[Manager]
DefaultLimitNOFILE=65536
DefaultLimitNPROC=32768
EOF

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê –°–ï–¢–ï–í–´–• –ü–ê–†–ê–ú–ï–¢–†–û–í ====================
echo "üåê –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è —Å–µ—Ç–µ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤..."

# –°–æ–∑–¥–∞–Ω–∏–µ —Ñ–∞–π–ª–∞ —Å —Å–µ—Ç–µ–≤—ã–º–∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è–º–∏
sudo tee /etc/sysctl.d/99-microservices.conf << 'EOF'
# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤ —Å–µ—Ç–∏
net.core.rmem_default = 262144
net.core.rmem_max = 16777216
net.core.wmem_default = 262144
net.core.wmem_max = 16777216

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –±—É—Ñ–µ—Ä–æ–≤ TCP
net.ipv4.tcp_rmem = 4096 65536 16777216
net.ipv4.tcp_wmem = 4096 65536 16777216

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ backlog –¥–ª—è –≤—Ö–æ–¥—è—â–∏—Ö —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
net.core.netdev_max_backlog = 5000
net.ipv4.tcp_max_syn_backlog = 8192

# –ë—ã—Å—Ç—Ä–∞—è –ø–µ—Ä–µ—Ä–∞–±–æ—Ç–∫–∞ TIME_WAIT —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
net.ipv4.tcp_tw_reuse = 1
net.ipv4.tcp_fin_timeout = 30

# –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–∞ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ø–æ—Ä—Ç–æ–≤
net.ipv4.ip_local_port_range = 1024 65535

# –£–ª—É—á—à–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ —Ñ–∞–π–ª–æ–≤–æ–≥–æ –∫—ç—à–∞
vm.dirty_ratio = 15
vm.dirty_background_ratio = 5
EOF

# –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤
sudo sysctl -p /etc/sysctl.d/99-microservices.conf

# ==================== –ù–ê–°–¢–†–û–ô–ö–ê DOCKER –õ–ò–ú–ò–¢–û–í ====================
echo "üê≥ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker –ª–∏–º–∏—Ç–æ–≤..."

# –°–æ–∑–¥–∞–Ω–∏–µ –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –¥–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ Docker
sudo mkdir -p /etc/docker

# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Docker daemon —Å –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
sudo tee /etc/docker/daemon.json << 'EOF'
{
    "log-driver": "json-file",
    "log-opts": {
        "max-size": "10m",
        "max-file": "3"
    },
    "default-ulimits": {
        "nofile": {
            "name": "nofile",
            "hard": 65536,
            "soft": 65536
        },
        "nproc": {
            "name": "nproc",
            "hard": 32768,
            "soft": 32768
        }
    },
    "storage-driver": "overlay2",
    "features": {
        "buildkit": true
    }
}
EOF

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫ Docker –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π
sudo systemctl restart docker

echo "‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –Ω–∞—Å—Ç—Ä–æ–µ–Ω—ã —É—Å–ø–µ—à–Ω–æ!"
echo ""
echo "üìä –¢–µ–∫—É—â–∏–µ –ª–∏–º–∏—Ç—ã:"
echo "   –û—Ç–∫—Ä—ã—Ç—ã–µ —Ñ–∞–π–ª—ã: $(ulimit -n)"
echo "   –ü—Ä–æ—Ü–µ—Å—Å—ã: $(ulimit -u)"
echo ""
echo "üîÑ –†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å —Å–∏—Å—Ç–µ–º—É –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è –∏–∑–º–µ–Ω–µ–Ω–∏–π"
```

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Ä–µ—Å—É—Ä—Å–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞

### –°–∫—Ä–∏–ø—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã

```bash
#!/bin/bash
# scripts/system-health.sh
# –°–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞

# –¶–≤–µ—Ç–∞ –¥–ª—è –≤—ã–≤–æ–¥–∞
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m' # No Color

echo "üîç –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–∏—Å—Ç–µ–º—ã..."
echo "=================================="

# ==================== –ó–ê–ì–†–£–ó–ö–ê –°–ò–°–¢–ï–ú–´ ====================
echo -e "\nüìä ${YELLOW}–ó–∞–≥—Ä—É–∑–∫–∞ —Å–∏—Å—Ç–µ–º—ã:${NC}"
uptime

# ==================== –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï CPU ====================
echo -e "\nüíª ${YELLOW}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ CPU:${NC}"
top -bn1 | grep "Cpu(s)" | sed "s/.*, *\([0-9.]*\)%* id.*/\1/" | awk '{print "CPU Usage: " 100 - $1 "%"}'

# ==================== –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –ü–ê–ú–Ø–¢–ò ====================
echo -e "\nüß† ${YELLOW}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏:${NC}"
free -h | awk '/^Mem:/ {printf "Memory Usage: %s/%s (%.2f%%)\n", $3, $2, ($3/$2)*100}'

# ==================== –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï –î–ò–°–ö–ê ====================
echo -e "\nüíæ ${YELLOW}–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –¥–∏—Å–∫–∞:${NC}"
df -h | grep -vE '^Filesystem|tmpfs|cdrom' | awk '{print $5 " " $1 " " $6}' | while read output;
do
  usage=$(echo $output | awk '{print $1}' | sed 's/%//g')
  partition=$(echo $output | awk '{print $2}')
  mount=$(echo $output | awk '{print $3}')
  
  if [ $usage -ge 85 ]; then
    echo -e "${RED}WARNING: $mount ($partition) is ${usage}% full${NC}"
  elif [ $usage -ge 70 ]; then
    echo -e "${YELLOW}CAUTION: $mount ($partition) is ${usage}% full${NC}"
  else
    echo -e "${GREEN}OK: $mount ($partition) is ${usage}% full${NC}"
  fi
done

# ==================== –°–¢–ê–¢–£–° DOCKER ====================
echo -e "\nüê≥ ${YELLOW}–°—Ç–∞—Ç—É—Å Docker:${NC}"
if systemctl is-active --quiet docker; then
    echo -e "${GREEN}Docker –∞–∫—Ç–∏–≤–µ–Ω${NC}"
    docker system df
    echo ""
    echo "–ó–∞–ø—É—â–µ–Ω–Ω—ã–µ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã:"
    docker ps --format "table {{.Names}}\t{{.Image}}\t{{.Status}}\t{{.Ports}}"
else
    echo -e "${RED}Docker –Ω–µ –∞–∫—Ç–∏–≤–µ–Ω${NC}"
fi

# ==================== –°–ï–¢–ï–í–´–ï –°–û–ï–î–ò–ù–ï–ù–ò–Ø ====================
echo -e "\nüåê ${YELLOW}–°–µ—Ç–µ–≤—ã–µ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è:${NC}"
ss -tuln | grep :80 > /dev/null && echo -e "${GREEN}HTTP (80) –æ—Ç–∫—Ä—ã—Ç${NC}" || echo -e "${RED}HTTP (80) –∑–∞–∫—Ä—ã—Ç${NC}"
ss -tuln | grep :443 > /dev/null && echo -e "${GREEN}HTTPS (443) –æ—Ç–∫—Ä—ã—Ç${NC}" || echo -e "${RED}HTTPS (443) –∑–∞–∫—Ä—ã—Ç${NC}"
ss -tuln | grep :8080 > /dev/null && echo -e "${GREEN}API Gateway (8080) –æ—Ç–∫—Ä—ã—Ç${NC}" || echo -e "${RED}API Gateway (8080) –∑–∞–∫—Ä—ã—Ç${NC}"

# ==================== –ü–†–û–í–ï–†–ö–ê –õ–û–ì–û–í ====================
echo -e "\nüìù ${YELLOW}–ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏:${NC}"
journalctl --priority=err --since="1 hour ago" --no-pager -n 5

echo -e "\n‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–∏—Å—Ç–µ–º—ã –∑–∞–≤–µ—Ä—à–µ–Ω–∞"
```

## –ü—Ä–æ–≤–µ—Ä–æ—á–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

1. **–ö–∞–∫–∏–µ –æ—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø—Ä–∏ –±–∞–∑–æ–≤–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–µ —Å–µ—Ä–≤–µ—Ä–∞?**
2. **–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ –æ—Ç–∫–ª—é—á–∏—Ç—å –ø–∞—Ä–æ–ª—å–Ω—É—é –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é SSH?**
3. **–ö–∞–∫–∏–µ –ø–æ—Ä—Ç—ã –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –æ—Ç–∫—Ä—ã—Ç—ã –≤ firewall –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤?**
4. **–ö–∞–∫ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å Docker —Å–ª—É–∂–±—ã?**
5. **–ö–∞–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –ª–∏–º–∏—Ç—ã –≤–∞–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–ª—è –≤—ã—Å–æ–∫–æ–Ω–∞–≥—Ä—É–∂–µ–Ω–Ω—ã—Ö –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–π?**

## –ü—Ä–∞–∫—Ç–∏—á–µ—Å–∫–∏–µ –∑–∞–¥–∞–Ω–∏—è

### –ó–∞–¥–∞–Ω–∏–µ 1: –ë–∞–∑–æ–≤–∞—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ Ubuntu 22.04 —Å–µ—Ä–≤–µ—Ä
- –í—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç `server-setup.sh`
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—Å–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### –ó–∞–¥–∞–Ω–∏–µ 2: Docker —É—Å—Ç–∞–Ω–æ–≤–∫–∞
- –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Docker –∏—Å–ø–æ–ª—å–∑—É—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Docker –¥–ª—è —Ä–∞–±–æ—Ç—ã –±–µ–∑ sudo
- –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –∑–∞–ø—É—Å–∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞

### –ó–∞–¥–∞–Ω–∏–µ 3: –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
- –°–æ–∑–¥–∞–π—Ç–µ —Å–∫—Ä–∏–ø—Ç –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Å–æ—Å—Ç–æ—è–Ω–∏—è —Å–µ—Ä–≤–µ—Ä–∞
- –ù–∞—Å—Ç—Ä–æ–π—Ç–µ –∞–ª–µ—Ä—Ç—ã –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ —Å —Å–∏—Å—Ç–µ–º–æ–π –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

## –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ–º—ã

- [[ansible-automation]] - –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è —Å Ansible
- [[nginx-load-balancer]] - –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞
- [[monitoring-logging]] - –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- [[automation-scripts]] - –°–∫—Ä–∏–ø—Ç—ã –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ 