# Python Backend Ecosystem: –ü–æ–ª–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ

## üêç Python Fundamentals

### Python –¥–ª—è Backend
```
–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ Python:
‚îú‚îÄ‚îÄ –ß–∏—Ç–∞–µ–º–æ—Å—Ç—å –∫–æ–¥–∞: –ø—Ä–æ—Å—Ç–æ–π –∏ –ø–æ–Ω—è—Ç–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
‚îú‚îÄ‚îÄ –ë–æ–≥–∞—Ç–∞—è —ç–∫–æ—Å–∏—Å—Ç–µ–º–∞: –º–Ω–æ–∂–µ—Å—Ç–≤–æ –±–∏–±–ª–∏–æ—Ç–µ–∫
‚îú‚îÄ‚îÄ –ë—ã—Å—Ç—Ä–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–¥—É–∫—Ç–∏–≤–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ –ú–Ω–æ–≥–æ–ø–∞—Ä–∞–¥–∏–≥–º–µ–Ω–Ω–æ—Å—Ç—å: –û–û–ü, —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ –ö—Ä–æ—Å—Å-–ø–ª–∞—Ç—Ñ–æ—Ä–º–µ–Ω–Ω–æ—Å—Ç—å: —Ä–∞–±–æ—Ç–∞ –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –û–°
‚îî‚îÄ‚îÄ –°–æ–æ–±—â–µ—Å—Ç–≤–æ: –∞–∫—Ç–∏–≤–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
‚îú‚îÄ‚îÄ Duck typing: —É—Ç–∏–Ω–∞—è —Ç–∏–ø–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ LEGB rule: –æ–±–ª–∞—Å—Ç—å –≤–∏–¥–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Decorators: –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ Context managers: –º–µ–Ω–µ–¥–∂–µ—Ä—ã –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞
‚îú‚îÄ‚îÄ Generators: –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ Asyncio: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ GIL: Global Interpreter Lock
```

### –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
```
–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã:
‚îú‚îÄ‚îÄ pip: —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –ø–∞–∫–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ pipenv: Pipfile + virtualenv
‚îú‚îÄ‚îÄ poetry: —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π –º–µ–Ω–µ–¥–∂–µ—Ä –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ conda: –Ω–∞—É—á–Ω—ã–µ –ø–∞–∫–µ—Ç—ã
‚îú‚îÄ‚îÄ virtualenv: –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ pyenv: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–µ—Ä—Å–∏—è–º–∏ Python

Poetry –ø—Ä–∏–º–µ—Ä:
```toml
[tool.poetry]
name = "my-backend"
version = "0.1.0"
description = "Backend API"

[tool.poetry.dependencies]
python = "^3.11"
fastapi = "^0.104.1"
uvicorn = "^0.24.0"
sqlalchemy = "^2.0.23"
pydantic = "^2.5.0"

[tool.poetry.group.dev.dependencies]
pytest = "^7.4.3"
black = "^23.11.0"
flake8 = "^6.1.0"
mypy = "^1.7.1"
```

## üåê Web Frameworks

### FastAPI
```
–°–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫:
‚îú‚îÄ‚îÄ Automatic API docs: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Type hints: –ø–æ–¥—Å–∫–∞–∑–∫–∏ —Ç–∏–ø–æ–≤
‚îú‚îÄ‚îÄ Async support: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞
‚îú‚îÄ‚îÄ Pydantic integration: –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ High performance: –≤—ã—Å–æ–∫–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ OpenAPI standard: —Å—Ç–∞–Ω–¥–∞—Ä—Ç OpenAPI
‚îî‚îÄ‚îÄ Dependency injection: –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã:
‚îú‚îÄ‚îÄ Path operations: –æ–ø–µ—Ä–∞—Ü–∏–∏ –ø—É—Ç–µ–π
‚îú‚îÄ‚îÄ Request/Response models: –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤/–æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ Dependency injection: –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ Middleware: –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îú‚îÄ‚îÄ Background tasks: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ WebSocket support: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket
‚îî‚îÄ‚îÄ Testing: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è:
```python
from fastapi import FastAPI, Depends, HTTPException
from pydantic import BaseModel
from sqlalchemy.orm import Session
from typing import List

app = FastAPI(title="User API", version="1.0.0")

class UserBase(BaseModel):
    email: str
    name: str

class UserCreate(UserBase):
    password: str

class User(UserBase):
    id: int
    is_active: bool
    
    class Config:
        orm_mode = True

# Dependency
def get_db():
    db = SessionLocal()
    try:
        yield db
    finally:
        db.close()

@app.post("/users/", response_model=User)
async def create_user(user: UserCreate, db: Session = Depends(get_db)):
    db_user = get_user_by_email(db, email=user.email)
    if db_user:
        raise HTTPException(status_code=400, detail="Email already registered")
    return create_user_db(db=db, user=user)

@app.get("/users/", response_model=List[User])
async def read_users(skip: int = 0, limit: int = 100, db: Session = Depends(get_db)):
    users = get_users(db, skip=skip, limit=limit)
    return users

@app.get("/users/{user_id}", response_model=User)
async def read_user(user_id: int, db: Session = Depends(get_db)):
    db_user = get_user(db, user_id=user_id)
    if db_user is None:
        raise HTTPException(status_code=404, detail="User not found")
    return db_user
```

### Django
```
–ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π —Ñ—Ä–µ–π–º–≤–æ—Ä–∫:
‚îú‚îÄ‚îÄ ORM: –æ–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ Admin panel: –ø–∞–Ω–µ–ª—å –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ Authentication: —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ Forms: –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ñ–æ—Ä–º
‚îú‚îÄ‚îÄ Templates: —Å–∏—Å—Ç–µ–º–∞ —à–∞–±–ª–æ–Ω–æ–≤
‚îú‚îÄ‚îÄ Middleware: –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îú‚îÄ‚îÄ Security: –≤—Å—Ç—Ä–æ–µ–Ω–Ω–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ I18n: –∏–Ω—Ç–µ—Ä–Ω–∞—Ü–∏–æ–Ω–∞–ª–∏–∑–∞—Ü–∏—è

–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ MTV:
‚îú‚îÄ‚îÄ Model: –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ Template: —à–∞–±–ª–æ–Ω –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è
‚îú‚îÄ‚îÄ View: –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ (–∫–æ–Ω—Ç—Ä–æ–ª–ª–µ—Ä)
‚îú‚îÄ‚îÄ URL dispatcher: –¥–∏—Å–ø–µ—Ç—á–µ—Ä URL
‚îú‚îÄ‚îÄ Settings: –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îî‚îÄ‚îÄ Apps: –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è Django

Django REST Framework:
‚îú‚îÄ‚îÄ Serializers: —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ ViewSets: –Ω–∞–±–æ—Ä—ã –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π
‚îú‚îÄ‚îÄ Routers: –º–∞—Ä—à—Ä—É—Ç–∏–∑–∞—Ç–æ—Ä—ã
‚îú‚îÄ‚îÄ Permissions: —Ä–∞–∑—Ä–µ—à–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Authentication: –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Throttling: –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Å–∫–æ—Ä–æ—Å—Ç–∏
‚îî‚îÄ‚îÄ Pagination: –ø–∞–≥–∏–Ω–∞—Ü–∏—è

–ü—Ä–∏–º–µ—Ä API:
```python
from rest_framework import viewsets, permissions
from rest_framework.decorators import action
from rest_framework.response import Response
from .models import User
from .serializers import UserSerializer

class UserViewSet(viewsets.ModelViewSet):
    queryset = User.objects.all()
    serializer_class = UserSerializer
    permission_classes = [permissions.IsAuthenticated]
    
    @action(detail=True, methods=['post'])
    def set_password(self, request, pk=None):
        user = self.get_object()
        password = request.data.get('password')
        user.set_password(password)
        user.save()
        return Response({'status': 'password set'})
    
    @action(detail=False)
    def recent_users(self, request):
        recent = User.objects.filter(
            date_joined__gte=timezone.now() - timedelta(days=7)
        )
        serializer = self.get_serializer(recent, many=True)
        return Response(serializer.data)
```

### Flask
```
–ú–∏–∫—Ä–æ—Ñ—Ä–µ–π–º–≤–æ—Ä–∫:
‚îú‚îÄ‚îÄ Minimalist: –º–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π
‚îú‚îÄ‚îÄ Flexible: –≥–∏–±–∫–∏–π
‚îú‚îÄ‚îÄ Extensible: —Ä–∞—Å—à–∏—Ä—è–µ–º—ã–π
‚îú‚îÄ‚îÄ Blueprints: –º–æ–¥—É–ª–∏
‚îú‚îÄ‚îÄ Jinja2: —à–∞–±–ª–æ–Ω–∏–∑–∞—Ç–æ—Ä
‚îú‚îÄ‚îÄ Werkzeug: WSGI —É—Ç–∏–ª–∏—Ç—ã
‚îî‚îÄ‚îÄ Configuration: –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

Flask-RESTful –ø—Ä–∏–º–µ—Ä:
```python
from flask import Flask
from flask_restful import Api, Resource, reqparse
from flask_sqlalchemy import SQLAlchemy

app = Flask(__name__)
app.config['SQLALCHEMY_DATABASE_URI'] = 'sqlite:///users.db'
db = SQLAlchemy(app)
api = Api(app)

class User(db.Model):
    id = db.Column(db.Integer, primary_key=True)
    name = db.Column(db.String(80), nullable=False)
    email = db.Column(db.String(120), unique=True, nullable=False)

class UserResource(Resource):
    def get(self, user_id):
        user = User.query.get_or_404(user_id)
        return {'id': user.id, 'name': user.name, 'email': user.email}
    
    def put(self, user_id):
        parser = reqparse.RequestParser()
        parser.add_argument('name', type=str, required=True)
        parser.add_argument('email', type=str, required=True)
        args = parser.parse_args()
        
        user = User.query.get_or_404(user_id)
        user.name = args['name']
        user.email = args['email']
        db.session.commit()
        
        return {'id': user.id, 'name': user.name, 'email': user.email}

api.add_resource(UserResource, '/users/<int:user_id>')
```

## üóÑÔ∏è Database Integration

### SQLAlchemy
```
ORM –¥–ª—è Python:
‚îú‚îÄ‚îÄ Core: –Ω–∏–∑–∫–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π SQL
‚îú‚îÄ‚îÄ ORM: –æ–±—ä–µ–∫—Ç–Ω–æ-—Ä–µ–ª—è—Ü–∏–æ–Ω–Ω–æ–µ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
‚îú‚îÄ‚îÄ Connection pooling: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ Migrations: –º–∏–≥—Ä–∞—Ü–∏–∏ (—Å Alembic)
‚îú‚îÄ‚îÄ Multiple databases: –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ –ë–î
‚îî‚îÄ‚îÄ Async support: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞

–ú–æ–¥–µ–ª–∏:
```python
from sqlalchemy import Column, Integer, String, Boolean, DateTime, ForeignKey
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import relationship
from datetime import datetime

Base = declarative_base()

class User(Base):
    __tablename__ = 'users'
    
    id = Column(Integer, primary_key=True)
    email = Column(String(120), unique=True, nullable=False)
    name = Column(String(80), nullable=False)
    is_active = Column(Boolean, default=True)
    created_at = Column(DateTime, default=datetime.utcnow)
    
    posts = relationship("Post", back_populates="author")

class Post(Base):
    __tablename__ = 'posts'
    
    id = Column(Integer, primary_key=True)
    title = Column(String(200), nullable=False)
    content = Column(String(2000))
    author_id = Column(Integer, ForeignKey('users.id'))
    created_at = Column(DateTime, default=datetime.utcnow)
    
    author = relationship("User", back_populates="posts")

# –ó–∞–ø—Ä–æ—Å—ã
def get_user_posts(db: Session, user_id: int):
    return db.query(Post).filter(Post.author_id == user_id).all()

def create_user(db: Session, user: UserCreate):
    db_user = User(email=user.email, name=user.name)
    db.add(db_user)
    db.commit()
    db.refresh(db_user)
    return db_user
```

### Async SQLAlchemy
```
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è:
‚îú‚îÄ‚îÄ asyncio support: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ asyncio
‚îú‚îÄ‚îÄ Async sessions: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Å–µ—Å—Å–∏–∏
‚îú‚îÄ‚îÄ Async queries: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
‚îú‚îÄ‚îÄ Connection pooling: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îî‚îÄ‚îÄ Performance: –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

–ü—Ä–∏–º–µ—Ä:
```python
from sqlalchemy.ext.asyncio import AsyncSession, create_async_engine
from sqlalchemy.orm import sessionmaker
from sqlalchemy import select

engine = create_async_engine("postgresql+asyncpg://user:pass@localhost/db")
AsyncSessionLocal = sessionmaker(engine, class_=AsyncSession, expire_on_commit=False)

async def get_user(db: AsyncSession, user_id: int):
    result = await db.execute(select(User).where(User.id == user_id))
    return result.scalar_one_or_none()

async def get_users(db: AsyncSession, skip: int = 0, limit: int = 100):
    result = await db.execute(select(User).offset(skip).limit(limit))
    return result.scalars().all()
```

### MongoDB —Å Motor
```
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π MongoDB:
‚îú‚îÄ‚îÄ Motor: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –¥—Ä–∞–π–≤–µ—Ä
‚îú‚îÄ‚îÄ Document database: –¥–æ–∫—É–º–µ–Ω—Ç–Ω–∞—è –ë–î
‚îú‚îÄ‚îÄ Flexible schema: –≥–∏–±–∫–∞—è —Å—Ö–µ–º–∞
‚îú‚îÄ‚îÄ Aggregation: –∞–≥—Ä–µ–≥–∞—Ü–∏—è
‚îú‚îÄ‚îÄ GridFS: —Ñ–∞–π–ª–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞
‚îî‚îÄ‚îÄ Replica sets: –Ω–∞–±–æ—Ä—ã —Ä–µ–ø–ª–∏–∫

–ü—Ä–∏–º–µ—Ä:
```python
from motor.motor_asyncio import AsyncIOMotorClient
from bson import ObjectId
from typing import List, Optional

class MongoManager:
    def __init__(self, connection_string: str):
        self.client = AsyncIOMotorClient(connection_string)
        self.db = self.client.myapp
        self.users = self.db.users
    
    async def create_user(self, user_data: dict) -> str:
        result = await self.users.insert_one(user_data)
        return str(result.inserted_id)
    
    async def get_user(self, user_id: str) -> Optional[dict]:
        user = await self.users.find_one({"_id": ObjectId(user_id)})
        if user:
            user["_id"] = str(user["_id"])
        return user
    
    async def get_users(self, skip: int = 0, limit: int = 100) -> List[dict]:
        cursor = self.users.find({}).skip(skip).limit(limit)
        users = await cursor.to_list(length=limit)
        for user in users:
            user["_id"] = str(user["_id"])
        return users
```

## üîê Authentication & Security

### JWT —Å PyJWT
```
JSON Web Tokens:
‚îú‚îÄ‚îÄ Token generation: –≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ Token verification: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–æ–∫–µ–Ω–æ–≤
‚îú‚îÄ‚îÄ Claims: —É—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Expiration: –∏—Å—Ç–µ—á–µ–Ω–∏–µ —Å—Ä–æ–∫–∞
‚îú‚îÄ‚îÄ Refresh tokens: —Ç–æ–∫–µ–Ω—ã –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îî‚îÄ‚îÄ Security: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```python
import jwt
from datetime import datetime, timedelta
from passlib.context import CryptContext
from typing import Optional

pwd_context = CryptContext(schemes=["bcrypt"], deprecated="auto")

SECRET_KEY = "your-secret-key"
ALGORITHM = "HS256"
ACCESS_TOKEN_EXPIRE_MINUTES = 30

def verify_password(plain_password: str, hashed_password: str) -> bool:
    return pwd_context.verify(plain_password, hashed_password)

def get_password_hash(password: str) -> str:
    return pwd_context.hash(password)

def create_access_token(data: dict, expires_delta: Optional[timedelta] = None):
    to_encode = data.copy()
    if expires_delta:
        expire = datetime.utcnow() + expires_delta
    else:
        expire = datetime.utcnow() + timedelta(minutes=15)
    to_encode.update({"exp": expire})
    encoded_jwt = jwt.encode(to_encode, SECRET_KEY, algorithm=ALGORITHM)
    return encoded_jwt

def verify_token(token: str):
    try:
        payload = jwt.decode(token, SECRET_KEY, algorithms=[ALGORITHM])
        email: str = payload.get("sub")
        if email is None:
            raise HTTPException(status_code=401, detail="Invalid token")
        return email
    except jwt.PyJWTError:
        raise HTTPException(status_code=401, detail="Invalid token")
```

### OAuth2 —Å Authlib
```
OAuth2 –ø—Ä–æ–≤–∞–π–¥–µ—Ä:
‚îú‚îÄ‚îÄ Authorization server: —Å–µ—Ä–≤–µ—Ä –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ Resource server: —Å–µ—Ä–≤–µ—Ä —Ä–µ—Å—É—Ä—Å–æ–≤
‚îú‚îÄ‚îÄ Client credentials: —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç–∞
‚îú‚îÄ‚îÄ Authorization code: –∫–æ–¥ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏
‚îú‚îÄ‚îÄ Implicit grant: –Ω–µ—è–≤–Ω–æ–µ –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ
‚îî‚îÄ‚îÄ Password grant: –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è

FastAPI + OAuth2:
```python
from authlib.integrations.starlette_client import OAuth
from starlette.middleware.sessions import SessionMiddleware

oauth = OAuth()
oauth.register(
    name='google',
    client_id='your-client-id',
    client_secret='your-client-secret',
    server_metadata_url='https://accounts.google.com/.well-known/openid_configuration',
    client_kwargs={'scope': 'openid email profile'}
)

app.add_middleware(SessionMiddleware, secret_key="your-secret-key")

@app.get('/auth/google')
async def google_auth(request: Request):
    redirect_uri = request.url_for('google_callback')
    return await oauth.google.authorize_redirect(request, redirect_uri)

@app.get('/auth/google/callback')
async def google_callback(request: Request):
    token = await oauth.google.authorize_access_token(request)
    user_info = token.get('userinfo')
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ
    return {"user": user_info}
```

## üîÑ Async Programming

### Asyncio Fundamentals
```
–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ:
‚îú‚îÄ‚îÄ Event loop: —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ Coroutines: –∫–æ—Ä—É—Ç–∏–Ω—ã
‚îú‚îÄ‚îÄ Tasks: –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ Futures: –±—É–¥—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è
‚îú‚îÄ‚îÄ Async/await: —Å–∏–Ω—Ç–∞–∫—Å–∏—Å
‚îî‚îÄ‚îÄ Concurrency: –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–Ω–æ—Å—Ç—å

–û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏:
‚îú‚îÄ‚îÄ async def: –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∫–æ—Ä—É—Ç–∏–Ω—ã
‚îú‚îÄ‚îÄ await: –æ–∂–∏–¥–∞–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞
‚îú‚îÄ‚îÄ asyncio.create_task(): —Å–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ asyncio.gather(): –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ asyncio.run(): –∑–∞–ø—É—Å–∫ —Ü–∏–∫–ª–∞ —Å–æ–±—ã—Ç–∏–π
‚îî‚îÄ‚îÄ asyncio.sleep(): –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –ø–∞—É–∑–∞
```

### Async HTTP –∫–ª–∏–µ–Ω—Ç—ã
```
aiohttp:
‚îú‚îÄ‚îÄ Async HTTP client: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP –∫–ª–∏–µ–Ω—Ç
‚îú‚îÄ‚îÄ Async HTTP server: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π HTTP —Å–µ—Ä–≤–µ—Ä
‚îú‚îÄ‚îÄ WebSocket support: –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WebSocket
‚îú‚îÄ‚îÄ Middleware: –ø—Ä–æ–º–µ–∂—É—Ç–æ—á–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
‚îú‚îÄ‚îÄ Session management: —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ—Å—Å–∏—è–º–∏
‚îî‚îÄ‚îÄ Connection pooling: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π

–ü—Ä–∏–º–µ—Ä:
```python
import aiohttp
import asyncio
from typing import List, Dict

async def fetch_user(session: aiohttp.ClientSession, user_id: int) -> Dict:
    async with session.get(f'https://api.example.com/users/{user_id}') as response:
        return await response.json()

async def fetch_multiple_users(user_ids: List[int]) -> List[Dict]:
    async with aiohttp.ClientSession() as session:
        tasks = [fetch_user(session, user_id) for user_id in user_ids]
        return await asyncio.gather(*tasks)

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
users = asyncio.run(fetch_multiple_users([1, 2, 3, 4, 5]))
```

httpx:
```python
import httpx
import asyncio

async def async_request_example():
    async with httpx.AsyncClient() as client:
        response = await client.get('https://api.example.com/data')
        return response.json()

# –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç sync –∏ async API
def sync_request_example():
    with httpx.Client() as client:
        response = client.get('https://api.example.com/data')
        return response.json()
```

## üß™ Testing

### Pytest
```
–§—Ä–µ–π–º–≤–æ—Ä–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:
‚îú‚îÄ‚îÄ Test discovery: –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∏–µ —Ç–µ—Å—Ç–æ–≤
‚îú‚îÄ‚îÄ Fixtures: —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ Parametrization: –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Mocking: –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ Coverage: –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
‚îú‚îÄ‚îÄ Plugins: –ø–ª–∞–≥–∏–Ω—ã
‚îî‚îÄ‚îÄ Async testing: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–∏–º–µ—Ä —Ç–µ—Å—Ç–æ–≤:
```python
import pytest
from fastapi.testclient import TestClient
from sqlalchemy import create_engine
from sqlalchemy.orm import sessionmaker
from main import app, get_db
from database import Base

SQLALCHEMY_DATABASE_URL = "sqlite:///./test.db"
engine = create_engine(SQLALCHEMY_DATABASE_URL, connect_args={"check_same_thread": False})
TestingSessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)

@pytest.fixture(scope="session")
def db():
    Base.metadata.create_all(bind=engine)
    db = TestingSessionLocal()
    try:
        yield db
    finally:
        db.close()
        Base.metadata.drop_all(bind=engine)

@pytest.fixture
def client(db):
    def override_get_db():
        try:
            yield db
        finally:
            db.close()
    
    app.dependency_overrides[get_db] = override_get_db
    with TestClient(app) as c:
        yield c

def test_create_user(client):
    response = client.post("/users/", json={"name": "Test User", "email": "test@example.com"})
    assert response.status_code == 201
    data = response.json()
    assert data["name"] == "Test User"
    assert data["email"] == "test@example.com"

def test_get_user(client):
    # –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    create_response = client.post("/users/", json={"name": "Test User", "email": "test@example.com"})
    user_id = create_response.json()["id"]
    
    # –ü–æ–ª—É—á–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    response = client.get(f"/users/{user_id}")
    assert response.status_code == 200
    data = response.json()
    assert data["name"] == "Test User"
```

### Async Testing
```
pytest-asyncio:
‚îú‚îÄ‚îÄ Async fixtures: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ñ–∏–∫—Å—Ç—É—Ä—ã
‚îú‚îÄ‚îÄ Async tests: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îú‚îÄ‚îÄ Event loop: —Ü–∏–∫–ª —Å–æ–±—ã—Ç–∏–π
‚îú‚îÄ‚îÄ Async mocking: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –º–æ–∫–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ Database testing: —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ë–î

–ü—Ä–∏–º–µ—Ä:
```python
import pytest
import asyncio
from httpx import AsyncClient
from main import app

@pytest.mark.asyncio
async def test_async_endpoint():
    async with AsyncClient(app=app, base_url="http://test") as client:
        response = await client.get("/users/")
        assert response.status_code == 200

@pytest.fixture
async def async_client():
    async with AsyncClient(app=app, base_url="http://test") as client:
        yield client

@pytest.mark.asyncio
async def test_with_fixture(async_client):
    response = await async_client.post("/users/", json={"name": "Test", "email": "test@example.com"})
    assert response.status_code == 201
```

## üìä API Documentation

### OpenAPI —Å FastAPI
```
–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
‚îú‚îÄ‚îÄ Swagger UI: –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ ReDoc: –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
‚îú‚îÄ‚îÄ OpenAPI schema: —Å—Ö–µ–º–∞ API
‚îú‚îÄ‚îÄ Response models: –º–æ–¥–µ–ª–∏ –æ—Ç–≤–µ—Ç–æ–≤
‚îú‚îÄ‚îÄ Request models: –º–æ–¥–µ–ª–∏ –∑–∞–ø—Ä–æ—Å–æ–≤
‚îî‚îÄ‚îÄ Examples: –ø—Ä–∏–º–µ—Ä—ã

–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è:
```python
from fastapi import FastAPI
from pydantic import BaseModel, Field
from typing import Optional

app = FastAPI(
    title="My API",
    description="This is a very fancy project, with auto docs for the API and everything",
    version="2.5.0",
    contact={
        "name": "Deadpoolio the Amazing",
        "url": "http://x-force.example.com/contact/",
        "email": "dp@x-force.example.com",
    },
    license_info={
        "name": "Apache 2.0",
        "url": "https://www.apache.org/licenses/LICENSE-2.0.html",
    },
)

class UserCreate(BaseModel):
    name: str = Field(..., description="The name of the user", example="John Doe")
    email: str = Field(..., description="The email of the user", example="john@example.com")
    age: Optional[int] = Field(None, description="The age of the user", example=25)

@app.post("/users/", response_model=User, tags=["users"])
async def create_user(
    user: UserCreate,
    db: Session = Depends(get_db)
):
    """
    Create a new user with all the information:
    
    - **name**: required string
    - **email**: required string, must be valid email
    - **age**: optional integer
    """
    return create_user_db(db=db, user=user)
```

## üöÄ Performance Optimization

### Caching
```
Redis caching:
‚îú‚îÄ‚îÄ Cache-aside pattern: –ø–∞—Ç—Ç–µ—Ä–Ω –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏—è
‚îú‚îÄ‚îÄ TTL: –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏
‚îú‚îÄ‚îÄ Cache invalidation: –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫–µ—à–∞
‚îú‚îÄ‚îÄ Distributed caching: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–µ –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ Cache warming: –ø—Ä–æ–≥—Ä–µ–≤ –∫–µ—à–∞

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
```python
import redis
import json
import asyncio
from typing import Optional, Any

class CacheManager:
    def __init__(self, redis_url: str):
        self.redis = redis.from_url(redis_url, decode_responses=True)
    
    async def get(self, key: str) -> Optional[Any]:
        try:
            value = self.redis.get(key)
            return json.loads(value) if value else None
        except Exception:
            return None
    
    async def set(self, key: str, value: Any, ttl: int = 3600):
        try:
            self.redis.setex(key, ttl, json.dumps(value))
        except Exception:
            pass
    
    async def delete(self, key: str):
        try:
            self.redis.delete(key)
        except Exception:
            pass

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ FastAPI
cache = CacheManager("redis://localhost:6379")

@app.get("/users/{user_id}")
async def get_user(user_id: int, db: Session = Depends(get_db)):
    cache_key = f"user:{user_id}"
    
    # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–µ—à
    cached_user = await cache.get(cache_key)
    if cached_user:
        return cached_user
    
    # –ü–æ–ª—É—á–∞–µ–º –∏–∑ –ë–î
    user = db.query(User).filter(User.id == user_id).first()
    if not user:
        raise HTTPException(status_code=404, detail="User not found")
    
    # –ö–µ—à–∏—Ä—É–µ–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
    user_data = {"id": user.id, "name": user.name, "email": user.email}
    await cache.set(cache_key, user_data, ttl=1800)
    
    return user_data
```

### Database Optimization
```
–û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤:
‚îú‚îÄ‚îÄ Eager loading: –∂–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚îú‚îÄ‚îÄ Lazy loading: –ª–µ–Ω–∏–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚îú‚îÄ‚îÄ Connection pooling: –ø—É–ª —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–π
‚îú‚îÄ‚îÄ Query optimization: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
‚îú‚îÄ‚îÄ Indexing: –∏–Ω–¥–µ–∫—Å–∞—Ü–∏—è
‚îî‚îÄ‚îÄ Batch operations: –ø–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏

SQLAlchemy –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è:
```python
from sqlalchemy.orm import joinedload, selectinload
from sqlalchemy import func

# –ñ–∞–¥–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ —Å–≤—è–∑–µ–π
def get_users_with_posts(db: Session):
    return db.query(User).options(joinedload(User.posts)).all()

# –ü–∞–∫–µ—Ç–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏
def create_multiple_users(db: Session, users: List[UserCreate]):
    db_users = [User(**user.dict()) for user in users]
    db.add_all(db_users)
    db.commit()
    return db_users

# –ê–≥—Ä–µ–≥–∞—Ü–∏—è
def get_user_stats(db: Session):
    return db.query(
        func.count(User.id).label('total_users'),
        func.count(User.id).filter(User.is_active == True).label('active_users'),
        func.avg(User.age).label('average_age')
    ).first()

# –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –ø–∞–≥–∏–Ω–∞—Ü–∏—è
def get_users_paginated(db: Session, page: int, per_page: int):
    offset = (page - 1) * per_page
    return db.query(User).offset(offset).limit(per_page).all()
```

## üîß Background Tasks

### Celery
```
–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–∞—è –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á:
‚îú‚îÄ‚îÄ Task queue: –æ—á–µ—Ä–µ–¥—å –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ Workers: –≤–æ—Ä–∫–µ—Ä—ã
‚îú‚îÄ‚îÄ Broker: –±—Ä–æ–∫–µ—Ä —Å–æ–æ–±—â–µ–Ω–∏–π
‚îú‚îÄ‚îÄ Result backend: —Ö—Ä–∞–Ω–∏–ª–∏—â–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
‚îú‚îÄ‚îÄ Scheduling: –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∑–∞–¥–∞—á
‚îú‚îÄ‚îÄ Monitoring: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îî‚îÄ‚îÄ Retry logic: –ª–æ–≥–∏–∫–∞ –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –ø–æ–ø—ã—Ç–æ–∫

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è:
```python
from celery import Celery
from kombu import Queue

app = Celery('myapp')
app.config_from_object('celeryconfig')

# celeryconfig.py
broker_url = 'redis://localhost:6379/0'
result_backend = 'redis://localhost:6379/0'
task_serializer = 'json'
accept_content = ['json']
result_serializer = 'json'
timezone = 'UTC'
enable_utc = True

task_routes = {
    'myapp.tasks.send_email': {'queue': 'email'},
    'myapp.tasks.process_data': {'queue': 'data'},
}

task_default_queue = 'default'
task_queues = (
    Queue('default', routing_key='default'),
    Queue('email', routing_key='email'),
    Queue('data', routing_key='data'),
)

# –ó–∞–¥–∞—á–∏
@app.task(bind=True, max_retries=3)
def send_email(self, email_data):
    try:
        # –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ email
        send_email_logic(email_data)
        return f"Email sent to {email_data['to']}"
    except Exception as exc:
        self.retry(countdown=60, exc=exc)

@app.task
def process_large_dataset(dataset_id):
    # –û–±—Ä–∞–±–æ—Ç–∫–∞ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö
    dataset = get_dataset(dataset_id)
    result = process_data(dataset)
    return result

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –≤ FastAPI
@app.post("/send-email/")
async def send_email_endpoint(email_data: EmailData):
    task = send_email.delay(email_data.dict())
    return {"task_id": task.id, "status": "queued"}

@app.get("/task/{task_id}")
async def get_task_status(task_id: str):
    task = send_email.AsyncResult(task_id)
    return {"task_id": task_id, "status": task.status, "result": task.result}
```

### Background Tasks –≤ FastAPI
```python
from fastapi import BackgroundTasks

def write_log(message: str):
    with open("log.txt", "a") as log:
        log.write(f"{message}\n")

@app.post("/send-notification/")
async def send_notification(email: str, background_tasks: BackgroundTasks):
    background_tasks.add_task(write_log, f"Notification sent to {email}")
    background_tasks.add_task(send_email_notification, email)
    return {"message": "Notification sent in the background"}
```

## üìä Monitoring & Logging

### Structured Logging
```python
import structlog
import logging
from datetime import datetime

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è structlog
structlog.configure(
    processors=[
        structlog.stdlib.filter_by_level,
        structlog.stdlib.add_logger_name,
        structlog.stdlib.add_log_level,
        structlog.stdlib.PositionalArgumentsFormatter(),
        structlog.processors.TimeStamper(fmt="iso"),
        structlog.processors.StackInfoRenderer(),
        structlog.processors.format_exc_info,
        structlog.processors.UnicodeDecoder(),
        structlog.processors.JSONRenderer()
    ],
    context_class=dict,
    logger_factory=structlog.stdlib.LoggerFactory(),
    wrapper_class=structlog.stdlib.BoundLogger,
    cache_logger_on_first_use=True,
)

logger = structlog.get_logger()

# Middleware –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è
@app.middleware("http")
async def logging_middleware(request: Request, call_next):
    start_time = datetime.utcnow()
    
    logger.info(
        "Request started",
        method=request.method,
        url=str(request.url),
        user_agent=request.headers.get("user-agent")
    )
    
    response = await call_next(request)
    
    process_time = (datetime.utcnow() - start_time).total_seconds()
    
    logger.info(
        "Request completed",
        method=request.method,
        url=str(request.url),
        status_code=response.status_code,
        process_time=process_time
    )
    
    return response
```

### Prometheus Metrics
```python
from prometheus_client import Counter, Histogram, generate_latest
from prometheus_client.openmetrics.exposition import CONTENT_TYPE_LATEST

# –ú–µ—Ç—Ä–∏–∫–∏
REQUEST_COUNT = Counter('requests_total', 'Total requests', ['method', 'endpoint'])
REQUEST_DURATION = Histogram('request_duration_seconds', 'Request duration')

@app.middleware("http")
async def prometheus_middleware(request: Request, call_next):
    start_time = time.time()
    
    response = await call_next(request)
    
    REQUEST_COUNT.labels(method=request.method, endpoint=request.url.path).inc()
    REQUEST_DURATION.observe(time.time() - start_time)
    
    return response

@app.get("/metrics")
async def metrics():
    return Response(generate_latest(), media_type=CONTENT_TYPE_LATEST)
```

## üê≥ Containerization

### Docker
```dockerfile
FROM python:3.11-slim

WORKDIR /app

# –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ —Å–∏—Å—Ç–µ–º—ã
RUN apt-get update && apt-get install -y \
    gcc \
    && rm -rf /var/lib/apt/lists/*

# –ö–æ–ø–∏—Ä—É–µ–º —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# –ö–æ–ø–∏—Ä—É–µ–º –∫–æ–¥ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
COPY . .

# –°–æ–∑–¥–∞–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
RUN useradd --create-home --shell /bin/bash app
USER app

# –≠–∫—Å–ø–æ–Ω–∏—Ä—É–µ–º –ø–æ—Ä—Ç
EXPOSE 8000

# –ö–æ–º–∞–Ω–¥–∞ –∑–∞–ø—É—Å–∫–∞
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]
```

### Docker Compose
```yaml
version: '3.8'

services:
  api:
    build: .
    ports:
      - "8000:8000"
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/mydb
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis
    volumes:
      - ./logs:/app/logs

  db:
    image: postgres:13
    environment:
      - POSTGRES_DB=mydb
      - POSTGRES_USER=user
      - POSTGRES_PASSWORD=password
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    ports:
      - "6379:6379"

  worker:
    build: .
    command: celery -A main.celery worker --loglevel=info
    environment:
      - DATABASE_URL=postgresql://user:password@db:5432/mydb
      - REDIS_URL=redis://redis:6379
    depends_on:
      - db
      - redis

volumes:
  postgres_data:
```

## üåç Deployment

### Gunicorn + Nginx
```python
# gunicorn.conf.py
bind = "0.0.0.0:8000"
workers = 4
worker_class = "uvicorn.workers.UvicornWorker"
worker_connections = 1000
max_requests = 1000
max_requests_jitter = 100
timeout = 30
keepalive = 2
preload_app = True
```

```nginx
# nginx.conf
upstream app {
    server app:8000;
}

server {
    listen 80;
    server_name yourdomain.com;
    
    location / {
        proxy_pass http://app;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
    
    location /static/ {
        alias /app/static/;
    }
    
    location /media/ {
        alias /app/media/;
    }
}
```

### Kubernetes
```yaml
apiVersion: apps/v1
kind: Deployment
metadata:
  name: python-api
spec:
  replicas: 3
  selector:
    matchLabels:
      app: python-api
  template:
    metadata:
      labels:
        app: python-api
    spec:
      containers:
      - name: api
        image: python-api:latest
        ports:
        - containerPort: 8000
        env:
        - name: DATABASE_URL
          valueFrom:
            secretKeyRef:
              name: app-secrets
              key: database-url
        livenessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 30
          periodSeconds: 10
        readinessProbe:
          httpGet:
            path: /health
            port: 8000
          initialDelaySeconds: 5
          periodSeconds: 5
---
apiVersion: v1
kind: Service
metadata:
  name: python-api-service
spec:
  selector:
    app: python-api
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8000
  type: LoadBalancer
```

## üîí Security Best Practices

### Input Validation
```python
from pydantic import BaseModel, validator, Field
from typing import Optional
import re

class UserCreate(BaseModel):
    name: str = Field(..., min_length=1, max_length=100)
    email: str = Field(..., regex=r'^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$')
    age: Optional[int] = Field(None, ge=0, le=150)
    
    @validator('name')
    def validate_name(cls, v):
        if not re.match(r'^[a-zA-Z\s]+$', v):
            raise ValueError('Name must contain only letters and spaces')
        return v.strip()
    
    @validator('email')
    def validate_email(cls, v):
        # –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è email
        if '@' not in v:
            raise ValueError('Invalid email format')
        return v.lower()

# Middleware –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏
@app.middleware("http")
async def validation_middleware(request: Request, call_next):
    # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –∑–∞–ø—Ä–æ—Å–∞
    if request.headers.get("content-length"):
        content_length = int(request.headers["content-length"])
        if content_length > 1024 * 1024:  # 1MB limit
            return JSONResponse(
                status_code=413,
                content={"error": "Request too large"}
            )
    
    response = await call_next(request)
    return response
```

### SQL Injection Prevention
```python
# –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –∏—Å–ø–æ–ª—å–∑—É–µ–º ORM
def get_user_by_email(db: Session, email: str):
    return db.query(User).filter(User.email == email).first()

# –ü—Ä–∞–≤–∏–ª—å–Ω–æ - –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã
def get_user_by_email_raw(db: Session, email: str):
    result = db.execute(
        text("SELECT * FROM users WHERE email = :email"),
        {"email": email}
    )
    return result.fetchone()

# –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û - —É—è–∑–≤–∏–º–æ –∫ SQL injection
def get_user_by_email_vulnerable(db: Session, email: str):
    query = f"SELECT * FROM users WHERE email = '{email}'"
    result = db.execute(text(query))
    return result.fetchone()
```

## üìö Learning Path

### Beginner
```
–û—Å–Ω–æ–≤—ã:
‚îú‚îÄ‚îÄ Python fundamentals: –æ—Å–Ω–æ–≤—ã Python
‚îú‚îÄ‚îÄ FastAPI basics: –æ—Å–Ω–æ–≤—ã FastAPI
‚îú‚îÄ‚îÄ Database integration: –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –ë–î
‚îú‚îÄ‚îÄ Basic authentication: –±–∞–∑–æ–≤–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
‚îú‚îÄ‚îÄ Testing: –æ—Å–Ω–æ–≤—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
‚îî‚îÄ‚îÄ Deployment: –±–∞–∑–æ–≤–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
```

### Intermediate
```
–°—Ä–µ–¥–Ω–∏–π —É—Ä–æ–≤–µ–Ω—å:
‚îú‚îÄ‚îÄ Advanced FastAPI: –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π FastAPI
‚îú‚îÄ‚îÄ Async programming: –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ Caching: –∫–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ Background tasks: —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îú‚îÄ‚îÄ Monitoring: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥
‚îú‚îÄ‚îÄ Security: –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îî‚îÄ‚îÄ Docker: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è
```

### Advanced
```
–ü—Ä–æ–¥–≤–∏–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å:
‚îú‚îÄ‚îÄ Microservices: –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã
‚îú‚îÄ‚îÄ Performance optimization: –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Advanced security: –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–∞—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îú‚îÄ‚îÄ Kubernetes: –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ System design: –ø—Ä–æ–µ–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —Å–∏—Å—Ç–µ–º
‚îú‚îÄ‚îÄ DevOps: –∫—É–ª—å—Ç—É—Ä–∞ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îî‚îÄ‚îÄ Distributed systems: —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã
```

## üõ†Ô∏è Tools & Libraries

### Development Tools
```
IDE –∏ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã:
‚îú‚îÄ‚îÄ PyCharm: –ø–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è IDE
‚îú‚îÄ‚îÄ VS Code: –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π —Ä–µ–¥–∞–∫—Ç–æ—Ä
‚îú‚îÄ‚îÄ Vim/Neovim: –∫–æ–Ω—Å–æ–ª—å–Ω—ã–µ —Ä–µ–¥–∞–∫—Ç–æ—Ä—ã
‚îî‚îÄ‚îÄ Jupyter: –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –±–ª–æ–∫–Ω–æ—Ç—ã

–õ–∏–Ω—Ç–µ—Ä—ã –∏ —Ñ–æ—Ä–º–∞—Ç–µ—Ä—ã:
‚îú‚îÄ‚îÄ Black: –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ isort: —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ –∏–º–ø–æ—Ä—Ç–æ–≤
‚îú‚îÄ‚îÄ flake8: –ø—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç–∏–ª—è –∫–æ–¥–∞
‚îú‚îÄ‚îÄ mypy: —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
‚îî‚îÄ‚îÄ bandit: —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

–û—Ç–ª–∞–¥–∫–∞:
‚îú‚îÄ‚îÄ pdb: –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥—á–∏–∫
‚îú‚îÄ‚îÄ ipdb: —É–ª—É—á—à–µ–Ω–Ω—ã–π –æ—Ç–ª–∞–¥—á–∏–∫
‚îú‚îÄ‚îÄ pytest-xdist: –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ
‚îî‚îÄ‚îÄ coverage: –ø–æ–∫—Ä—ã—Ç–∏–µ –∫–æ–¥–∞
```

### Production Tools
```
–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:
‚îú‚îÄ‚îÄ Sentry: –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –æ—à–∏–±–æ–∫
‚îú‚îÄ‚îÄ New Relic: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ Datadog: –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã
‚îî‚îÄ‚îÄ Prometheus: –º–µ—Ç—Ä–∏–∫–∏

–†–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ:
‚îú‚îÄ‚îÄ Heroku: –ø—Ä–æ—Å—Ç–æ–µ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏–µ
‚îú‚îÄ‚îÄ AWS: –æ–±–ª–∞—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
‚îú‚îÄ‚îÄ Google Cloud: –æ–±–ª–∞—á–Ω–∞—è –ø–ª–∞—Ç—Ñ–æ—Ä–º–∞
‚îú‚îÄ‚îÄ DigitalOcean: –ø—Ä–æ—Å—Ç—ã–µ VPS
‚îî‚îÄ‚îÄ Kubernetes: –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤
```

–î–∞–Ω–Ω–æ–µ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç comprehensive –æ–±–∑–æ—Ä —ç–∫–æ—Å–∏—Å—Ç–µ–º—ã Python –¥–ª—è backend —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏, –ø–æ–∫—Ä—ã–≤–∞—è –≤—Å–µ –∞—Å–ø–µ–∫—Ç—ã –æ—Ç –±–∞–∑–æ–≤—ã—Ö –∫–æ–Ω—Ü–µ–ø—Ü–∏–π –¥–æ –ø—Ä–æ–¥–≤–∏–Ω—É—Ç—ã—Ö —Ç–µ—Ö–Ω–∏–∫ —Ä–∞–∑–≤–µ—Ä—Ç—ã–≤–∞–Ω–∏—è –∏ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞. 